# ==============================================
# Finorbit Unified Backend Configuration
# ==============================================

# ---------------------------
# Google Gemini API Configuration
# ---------------------------
# For Google Gemini API endpoints
BASE_URL=https://generativelanguage.googleapis.com/v1beta/openai/
LLM_API_KEY=your_gemini_api_key_here
CUSTOM_MODEL_NAME=gemini-1.5-flash
HEADER_ID=

# ---------------------------
# Database Configuration
# ---------------------------
# PostgreSQL connection string (Neon, Supabase, or local)
# Use without sslmode and channel_binding parameters for Neon
DATABASE_URL=postgresql://user:password@host:port/database

# ---------------------------
# Router Configuration (CRITICAL FOR OBSERVABILITY)
# ---------------------------
# RAG Confidence Threshold (0.0 - 1.0)
# When LLM confidence falls below this, use keyword fallback
# Default: 0.7 (70% confidence required for LLM routing)
RAG_CONFIDENCE_THRESHOLD=0.7

# RAG Decision Cache Size
# How many queryâ†’decision pairs to cache (skips LLM calls on cache hits)
# Larger = better cache hit rate but more memory
# Default: 1000
RAG_CACHE_SIZE=1000

# Circuit Breaker: Failure Threshold
# Open circuit after N consecutive LLM failures
# When open, use keyword-only routing (no LLM calls)
# Default: 5 failures
LLM_CIRCUIT_BREAKER_THRESHOLD=5

# Circuit Breaker: Reset Time (seconds)
# Wait time before attempting LLM recovery after circuit opens
# Default: 60 seconds
LLM_CIRCUIT_BREAKER_RESET_SECS=60

# ---------------------------
# Validation & Confidence
# ---------------------------
# Minimum confidence score threshold for serving responses (0.0 - 1.0)
# Recommended: 0.7 (70% confidence)
CONFIDENCE_THRESHOLD=0.7

# ---------------------------
# Logging Configuration
# ---------------------------
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Enable structured JSON logging (true/false)
# Set to true for production (better for log aggregation)
JSON_LOGS=true

# ---------------------------
# Server Configuration
# ---------------------------
# API server host and port
HOST=0.0.0.0
PORT=8000

# CORS allowed origins (comma-separated)
# Example: http://localhost:3000,https://app.finorbit.ai
CORS_ORIGINS=*

# ---------------------------
# RAG System Configuration
# ---------------------------
# URL of the RAG API endpoint (usually running on a different port)
# Default: http://localhost:8001/query
RAG_API_URL=http://localhost:8001/query

# Enable/disable RAG lookup (true/false)
RAG_ENABLED=true

# ---------------------------
# Compliance (JSON-first; no DB)
# ---------------------------
COMPLIANCE_ENABLED=true
COMPLIANCE_RULES_PATH=backend/rules/compliance_rules.json
COMPLIANCE_CACHE_TTL_S=60

# Fail-closed only for CRITICAL categories (keeps fail-open elsewhere)
COMPLIANCE_FAIL_CLOSED_ENABLED=true
COMPLIANCE_FAIL_CLOSED_MODULES=FRAUD,TAX

# ---------------------------
# Final Output Design Engine (FODE)
# ---------------------------
FODE_ENABLED=true

# Advisor handover (confidence-based escalation)
# If enabled and confidence is below threshold (or recommended_action is partial/refuse),
# the system returns a deterministic handover message.
ADVISOR_HANDOVER_ENABLED=true
ADVISOR_HANDOVER_CONFIDENCE_THRESHOLD=0.50

